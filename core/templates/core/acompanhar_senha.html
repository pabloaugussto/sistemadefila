{% extends 'core/base.html' %} {% block title %}Acompanhar Senha - SenhaFácil{%
endblock %} {% block content %}
<div class="container text-center mt-5">
  <div class="row">
    <div class="col-md-6 offset-md-3">
      <div class="card border-primary">
        <div class="card-header bg-primary text-white">
          <h2><i class="bi bi-ticket-perforated"></i> Acompanhe sua Senha</h2>
        </div>
        <div class="card-body">
          <p class="fs-5">Sua senha é:</p>
          <h1 class="display-1 fw-bold text-primary mb-4">{{ senha }}</h1>

          <p class="fs-5">Sua posição na fila:</p>
          <h1 class="display-3 fw-bold mb-4">{{ posicao }}º</h1>

          <hr />

          <p class="fs-5 mt-4">Senha chamada no painel:</p>
          <h2>Acompanhe sua Senha</h2>

          <h2><i class="bi bi-ticket-perforated"></i> Acompanhe sua Senha</h2>
        </div>
        <div class="card-footer text-muted">Aguarde ser chamado.</div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  const filaSocket = new WebSocket(
    "ws://" + window.location.host + "/ws/fila/"
  );

  filaSocket.onopen = function (e) {
    console.log("Conexão WebSocket aberta com sucesso!");
  };

  filaSocket.onmessage = function (e) {
    const data = JSON.parse(e.data);
    console.log("Mensagem recebida do servidor:", data);

    if (data.type === "fila_update") {
      const elementoSenha = document.querySelector("#senha-chamada");
      const cardBody = elementoSenha.closest(".card-body");

      elementoSenha.innerText = data.message;

      if (cardBody) {
        cardBody.classList.add("bg-success", "text-white");
      }
    }
  };

  filaSocket.onclose = function (e) {
    console.error("Conexão WebSocket fechada inesperadamente.");
  };
</script>
{% endblock %}
